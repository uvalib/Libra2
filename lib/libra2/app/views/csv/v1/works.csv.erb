<%- headers = ['Id',
               'Depositor Email',
               'Author Email',
               'Author First Name',
               'Author Last Name',
               'Author Institution',
               'Author Department',
               'DOI',
               'Title',
               'Abstract',
               'Create Date',
               'Last Modified Date',
               'Published Date',
               'Creator Email',
               'Embargo State',
               'Embargo End Date',
               'Embargo Period',
               'Notes',
               'Admin Notes',
               'Rights',
               'Advisors',
               'Keywords',
               'Language',
               'Related Links',
               'Sponsoring Agency',
               'Degree',
               'Status',
               'Source',
               'Views',
               'Downloads',
               'File Count',
               'Total Size'
              ] -%>
<%= CSV.generate_line headers %>
<%- @records.each do |rec| -%>
   <%= raw( CSV.generate_line( [ rec.id,
                            rec.depositor_email,
                            rec.author_email,
                            rec.author_first_name,
                            rec.author_last_name,
                            rec.author_institution,
                            rec.author_department,
                            rec.identifier,
                            rec.title,
                            rec.abstract,
                            rec.create_date,
                            rec.modified_date,
                            rec.published_date,
                            rec.creator_email,
                            rec.embargo_state,
                            extract_date_from_timestamp_string( rec.embargo_end_date ),
                            rec.embargo_period.gsub( '_', ' ' ),
                            rec.notes,
                            rec.admin_notes,
                            rec.rights,
                            rec.advisors,
                            rec.keywords,
                            rec.language,
                            rec.related_links,
                            rec.sponsoring_agency,
                            rec.degree,
                            rec.status,
                            rec.source,
                            get_work_view_count( rec ),
                            get_work_download_count( rec ),
                            rec.filesets.length,
                            get_work_aggregate_size( rec )
                          ] ) ) -%>
<%- end -%>